{"componentChunkName":"component---src-templates-best-practice-detail-tsx","path":"/best-practice/2021-08-17-idaas-scf","result":{"data":{"currentBlog":{"id":"55d5414a-4ba1-5203-b80f-700df23bf07a","frontmatter":{"thumbnail":"https://main.qcloudimg.com/raw/e5b06897df1c1710162a159dc75fe6fd.jpg","authors":["腾讯云 IDaaS x 云函数"],"categories":["best-practice"],"date":"2021-08-17T00:00:00.000Z","title":"腾讯云 IDaaS + 云函数，不到 10 行代码解决企业身份难题","description":"如何快速集成腾讯云 IDaaS 的 SSO 能力，适用于企业内部快速开发产品企业应用的场景","authorslink":null,"translators":null,"translatorslink":null,"tags":["Serverless","云函数"],"keywords":null,"outdated":null},"wordCount":{"words":225,"sentences":40,"paragraphs":40},"fileAbsolutePath":"/Users/zhangxuewen/serverlesscloud.cn/content/best-practice/2021-08-17-idaas-scf.md","fields":{"slug":"/best-practice/2021-08-17-idaas-scf/","keywords":["serverless","云函数","云原生","腾讯","身份","应用"]},"html":"<p>企业内开发者经常需要开发各式各样自建应用，传统的开发方式很容易陷入一个身份困境：</p>\n<ol>\n<li>反复实现账号注册、注销等管理，写一堆账号、组织、角色表、关联表类和对应接口。</li>\n<li>面临繁琐各异的安全合规要求，挠头做密码有效期、GDPR 等数据合规。</li>\n<li>对接企业内外部各类认证方式，微信、AD 域账号等等持续新增和变更。</li>\n</ol>\n<p>当企业采用了腾讯云 IDaaS 之后，企业内开发者将可以省去以上烦恼，专注在自己的业务上，仅需在程序内注入几行代码、几分钟即可快速集成腾讯云 IDaaS。腾讯云 IDaaS 提供了不同编程语言的快速教程帮助企业开发者安全快速地对接，本文以基于腾讯云 Serverless 的 Node.js Express 框架为例，示例如何快速集成腾讯云 IDaaS 的 SSO 能力，适用于企业内部快速开发产品企业应用的场景，优势：</p>\n<ul>\n<li><strong>不到 10 行，5 分钟快速集成 - 腾讯云 IDaaS</strong></li>\n<li><strong>0 运维成本，按量收费 - 云原生 Serverless 框架</strong></li>\n</ul>\n<h2 id=\"01-什么是-腾讯云-idaas\" style=\"position:relative;\"><a href=\"#01-%E4%BB%80%E4%B9%88%E6%98%AF-%E8%85%BE%E8%AE%AF%E4%BA%91-idaas\" aria-label=\"01 什么是 腾讯云 idaas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>01. 什么是 腾讯云 IDaaS？</h2>\n<p>腾讯云 IDaaS（TencentCloud IDaaS，TCID）致力于为企业提供身份认证和数据管理服务。作为新一代企业身份连接平台，可针对多身份源进行数据清洗和数据聚合，适配复杂多样的企业既有应用和认证系统，实现企业应用身份的打通和连接。</p>\n<ul>\n<li><strong>统一目录</strong></li>\n</ul>\n<p>集成各类企业身份数据源、第三方认证系统或应用，打通身份目录同步与认证能力，实现对人员、组织架构及人员组等多维度身份数据的集中储存及权限规则管理。 </p>\n<ul>\n<li><strong>应用身份同步</strong></li>\n</ul>\n<p>支持本地与云端应用间的身份信息同步，快速映射身份数据，打通各应用间身份数据阻隔的壁垒。 </p>\n<ul>\n<li><strong>身份安全审计</strong></li>\n</ul>\n<p>提供人员访问记录、管理员操作记录、应用使用记录等多维度日志审计服务。管理授权、业务操作、审计监察均可独立授权，同类授权可批量操作。</p>\n<img src=\"https://main.qcloudimg.com/raw/d29c0f2ecbb2f145c2c957bb9ffca525.png\" width=\"700\">\n<h2 id=\"02-云函数--idaas快速部署\" style=\"position:relative;\"><a href=\"#02-%E4%BA%91%E5%87%BD%E6%95%B0--idaas%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2\" aria-label=\"02 云函数  idaas快速部署 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>02. 云函数 + IDaaS，快速部署</h2>\n<p><strong>1. 前提配置</strong></p>\n<p>确保在开始之前在腾讯云 IDaaS 中配置新建 OIDC 应用（选择 Web 子类别）如下图所示：</p>\n<img src=\"https://main.qcloudimg.com/raw/edeb79d3033e7071b974148264cd2a35.png\" width=\"700\">\n<p>我们假设应用程序将本地部署在 redirect uri，我们将获取和配置以下值：</p>\n<img src=\"https://main.qcloudimg.com/raw/2270c383a788f4a335e6c26703ba32ad.png\" width=\"700\">\n<p>准备开发环境：创建或者使用现有的 Express 应用。</p>\n<blockquote>\n<p>利用 Serverless 应用中心控制台创建：在腾讯云控制台搜索 Serverless，在应用 Tab 里面创建一个新的 Express 应用，如下图所示，指导参考文档：<a href=\"https://cloud.tencent.com/document/product/1154/43224\">https://cloud.tencent.com/document/product/1154/43224</a></p>\n</blockquote>\n<img src=\"https://main.qcloudimg.com/raw/228b7804dbd94d70a3c1ddb4bc91770f.png\" width=\"700\">\n<p><strong>2. 引入 SSO 依赖库</strong></p>\n<p>打开云 IDE，在您的 Express 项目依赖配置文件 package.json 中，加入以下依赖：</p>\n<ul>\n<li>express-openid-connect</li>\n</ul>\n<p>代码样例：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">\"dependencies\": {    \"express\": \"^4.17.1\",    \"express-openid-connect\": \"^2.4.0\", }</code></pre></div>\n<p>如下所示：</p>\n<img src=\"https://main.qcloudimg.com/raw/23fc79f47f309611742fc2f7384d3946.png\" width=\"700\">\n<p><strong>3. 配置参数</strong></p>\n<p>根据「前提配置」获取的信息，为您的程序配置以下环境变量：</p>\n<blockquote>\n<p>在 Serverless 中，需要在您的「函数服务 - 函数管理 - 函数配置」中进行配置。</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">CLIENT_ID= {clientId}CLIENT_SECRET= {clientSecret}ISSUER_BASE_URL= {IDaaS Wellkown}</code></pre></div>\n<p><strong>4. 程序集成 SSO</strong></p>\n<p>在 Express 的 app 文件中启用 SSO：加入 <code class=\"language-text\">app.use(auth(</code>，并在您希望保护的请求中加入<code class=\"language-text\">requiresAuth()</code>通过 <code class=\"language-text\">req.oidc.user</code>获取用户的属性，如下示例（<strong>共 9 行代码</strong>）：</p>\n<img src=\"https://main.qcloudimg.com/raw/56a8c8f52856c79039b421fc1775aad1.png\" width=\"700\">\n<p><strong>5. 自选身份认证</strong></p>\n<p>沿用腾讯云 IDaaS 的超级认证源能力，可以快速启用你想接入的企业认证方式：</p>\n<img src=\"https://main.qcloudimg.com/raw/56f233f04829f460fe051e349d19715a.png\" width=\"500\">\n<p>通过不到 10 行代码， 几分钟内您可以在创建一个 Express 应用并与腾讯云 IDaaS 集成 SSO使用，轻松创建和保护您的应用程序。作为开发人员，您只需使用从企业的腾讯云 IDaaS 管理员收到的参数添加到应用注册，引入对应 SDK，即可为您的应用程序启用 SSO 支持。</p>\n<h2 id=\"03-接入腾讯云-idaas\" style=\"position:relative;\"><a href=\"#03-%E6%8E%A5%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91-idaas\" aria-label=\"03 接入腾讯云 idaas permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>03. 接入腾讯云 IDaaS</h2>\n<p>为企业开启使用腾讯云 IDaaS，访问以下产品链接进行购买：<a href=\"https://cloud.tencent.com/product/tcid%EF%BC%8C%E5%8D%B3%E5%8F%AF%E8%8E%B7%E5%BE%97%E4%BC%81%E4%B8%9A%E7%8B%AC%E6%9C%89%E7%9A%84\">https://cloud.tencent.com/product/tcid，即可获得企业独有的</a> IDaaS 安全空间，提供为您的应用保驾护航。</p>\n<hr>\n<blockquote>\n<p><strong>传送门：</strong></p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/serverless/serverless/blob/master/README_CN.md\">github.com/serverless</a></li>\n<li>官网：<a href=\"https://serverless.com/\">serverless.com</a></li>\n</ul>\n</blockquote>\n<p>欢迎访问：<a href=\"https://serverlesscloud.cn/\">Serverless 中文网</a>，您可以在 <a href=\"https://serverlesscloud.cn/best-practice\">最佳实践</a> 里体验更多关于 Serverless 应用的开发！</p>","tableOfContents":"<ul>\n<li><a href=\"/best-practice/2021-08-17-idaas-scf/#01-%E4%BB%80%E4%B9%88%E6%98%AF-%E8%85%BE%E8%AE%AF%E4%BA%91-idaas\">01. 什么是 腾讯云 IDaaS？</a></li>\n<li><a href=\"/best-practice/2021-08-17-idaas-scf/#02-%E4%BA%91%E5%87%BD%E6%95%B0--idaas%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2\">02. 云函数 + IDaaS，快速部署</a></li>\n<li><a href=\"/best-practice/2021-08-17-idaas-scf/#03-%E6%8E%A5%E5%85%A5%E8%85%BE%E8%AE%AF%E4%BA%91-idaas\">03. 接入腾讯云 IDaaS</a></li>\n</ul>"},"previousBlog":{"id":"91cffb31-3458-56bd-ba10-1f0544c5f30b","frontmatter":{"thumbnail":"https://main.qcloudimg.com/raw/3a687ae2c6ef34b26887cde9a8bfa2f5.jpg","authors":["腾讯文档 x Serverless"],"categories":["best-practice"],"date":"2021-08-31T00:00:00.000Z","title":"腾讯文档业务上云，Serverless 架构应用最佳实践","description":"轻松实现可扩展、易维护、降低开发成本的目标","authorslink":null,"translators":null,"translatorslink":null,"tags":["Serverless","云函数"],"keywords":null,"outdated":null},"wordCount":{"words":346,"sentences":42,"paragraphs":42},"fileAbsolutePath":"/Users/zhangxuewen/serverlesscloud.cn/content/best-practice/2021-08-31-docsqq-serverless.md","fields":{"slug":"/best-practice/2021-08-31-docsqq-serverless/","keywords":["serverless","云函数","文档","Serverless","腾讯","函数","前端","服务","业务","版本"]}},"nextBlog":{"id":"0bf282d4-a8cd-5d85-a4a5-800674217ae6","frontmatter":{"thumbnail":"https://main.qcloudimg.com/raw/df4800b88b1c76a8a4b288a7ec037b8d.jpg","authors":["希蒂恩、kbjlchen"],"categories":["best-practice"],"date":"2021-08-11T00:00:00.000Z","title":"CDN 联合云函数 SCF，轻松实现定时刷新、预热任务","description":"插件中心是腾讯云 CDN 的增值插件功能的大本营，全新上线：定时刷新预热、APK 动态打包、区域访问控制！","authorslink":null,"translators":null,"translatorslink":null,"tags":["Serverless","云函数"],"keywords":null,"outdated":null},"wordCount":{"words":173,"sentences":32,"paragraphs":32},"fileAbsolutePath":"/Users/zhangxuewen/serverlesscloud.cn/content/best-practice/2021-08-09-cdn-scf.md","fields":{"slug":"/best-practice/2021-08-09-cdn-scf/","keywords":["serverless","云函数","预热","刷新","插件","定时"]}}},"pageContext":{"blogId":"55d5414a-4ba1-5203-b80f-700df23bf07a","previousBlogId":"91cffb31-3458-56bd-ba10-1f0544c5f30b","nextBlogId":"0bf282d4-a8cd-5d85-a4a5-800674217ae6"}},"staticQueryHashes":["126728070","2100134136"]}